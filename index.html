<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Conway's Game of Life</title>
	</head>
	
	<body>
		<fieldset>
			<legend>Parameters</legend>
			<label>Interval (ms)</label>
			<input id="interval" type="text" value="500"></input>
			<label>Tiles Across</label>
			<input id="gwidth" type="text" value="50"></input>
			<label>Tiles Down</label>
			<input id="gheight" type="text" value="35"></input>
			<button onclick="redrawGrid()">Redraw</button>
		</fieldset>
		<br>
		<button onclick="start()">Start</button>
		<button onclick="stop()">Stop</button>
		<p>
		<svg id="grid" width="800" height="800" xmlns="http://www.w3.org/2000/svg">
			<style type="text/css" >
				<![CDATA[
					rect.r_off { fill:#008d46; stroke-width:1; stroke:#3080d0; }
					rect.r_on { fill:#3080d0; stroke-width:1; stroke:#3080d0; }
				]]>
			</style>
		</svg>
	</body>
	
	<script>
		var TILE_SIZE = 15;
		
		function buildGrid(height, width) {
			var rv = new Array(height);
			var svg = document.getElementById('grid');
			svg.setAttribute('width', width * TILE_SIZE);
			svg.setAttribute('height', height * TILE_SIZE);
			
			for (var i = 0; i < height; i++) {
				rv[i] = new Array(width);
				for (var j = 0; j < width; j++) {
					var newElement = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
					newElement.setAttribute('width', TILE_SIZE);
					newElement.setAttribute('height', TILE_SIZE);
					newElement.setAttribute('x', j * TILE_SIZE);
					newElement.setAttribute('y', i * TILE_SIZE);
					newElement.setAttribute('class', 'r_off');
					newElement.addEventListener('click', function () {
						switchTile(this);
					});
					svg.appendChild(newElement);
					rv[i][j] = newElement;
				}
			}
			
			return rv;
		}
		
		function isLive(element) {
			return element.getAttribute('class') == 'r_on';
		}
		
		function liveNeighbours(grid, row, col) {
			var gh = grid.length - 1;
			var gw = grid[0].length - 1;
			var ln = 0;
			// top-left
			if (row > 0 && col > 0 && isLive(grid[row - 1][col - 1])) {
				ln++;
			}
			
			// above
			if (row > 0 && isLive(grid[row - 1][col])) {
				ln++;
			}
			
			// top-right
			if (row > 0 && col < gw && isLive(grid[row - 1][col + 1])) {
				ln++;
			}
			
			// left
			if (col > 0 && isLive(grid[row][col - 1])) {
				ln++;
			}
			
			// right
			if (col < gw && isLive(grid[row][col + 1])) {
				ln++;
			}
			
			// bottom-left
			if (row < gh && col > 0 && isLive(grid[row + 1][col - 1])) {
				ln++;
			}
			
			// below
			if (row < gh && isLive(grid[row + 1][col])) {
				ln++;
			}
			
			// bottom-right
			if (row < gh && col < gw && isLive(grid[row + 1][col + 1])) {
				ln++;
			}
			
			return ln;
		}
		
		function applyRules(grid) {
			var switchList = [];
			for (i = 0; i < grid.length; i++) {
				for (j = 0; j < grid[i].length; j++) {
					var ln = liveNeighbours(grid, i, j);
					var curEl = grid[i][j];
					if (isLive(curEl)) {
						if (ln < 2 || ln > 3) {
							switchList.push(curEl);
						}
					} else if (ln == 3) {
						switchList.push(curEl);
					}
				}
			}
			
			return switchList;
		}
		
		function switchTile(tile) {
			if (isLive(tile)) {
				tile.setAttribute('class', 'r_off');
			} else {
				tile.setAttribute('class', 'r_on');
			}
		}
		
		function switchTiles(switchList) {
			var size = switchList.length;
			for (i = 0; i < size; i++) {
				switchTile(switchList[i]);
			}
		}
		
		var grid = null;
		var token = null;
		redrawGrid();
		
		function start() {
			var inter = document.getElementById('interval').value;
			token = window.setInterval(function () {
				switchTiles(applyRules(grid));
			}, inter);
		}
		
		function stop() {
			if (token != null) {
				window.clearInterval(token);
				token = null;
			}
		}
		
		function redrawGrid() {
			var gridHeight = document.getElementById('gheight').value;
			var gridWidth = document.getElementById('gwidth').value;
			grid = buildGrid(gridHeight, gridWidth);
		}
	</script>
</html>
